# Mandatory exercise 2

The code part of the project is implemented in [Elixir](https://elixir-lang.org/). Running the project takes place within [Docker](https://www.docker.com/) containers, using the [docker-compose](https://docs.docker.com/compose/) tool to manage running containers for Alice and Bob.

## Requirements

In order to run this project, you need to have the following:

- Ideally run on a UNIX based operating system (MacOS, Linux or WSL).
- Have the `bash` shell available.
- Have installed the following programs:
  - `make`
  - `openssl`
  - `docker`
  - `docker-compose`


### Running the containers from remote

I have built the a version of the image before the handin deadline and pushed it to my own [Docker Hub repository](https://hub.docker.com/r/andreaswachs/itu.sec1.ma2). With this, you can run with the `remote` version of the docker-compose file. This means that you only need to have docker and docker-compose installed on your machine, regardless of OS.
Do note that the images are built on the x86 architecture, from an Intel based MacBook. You might have problems with the pre-built image if you run on an arm based system.

```sh
$ make run-remote
```

### Initial setup

You firstly need to setup the project by having certificates generated and building the docker container, like so:

```sh
$ make setup
```
### Running without building

Assuming you've already built the container for the project, you can simply run them:

```sh
$ make run
```

### Building

To build the docker containers you can run:

```sh
$ make build
```

### Building and running

To build and run the containers immediately after:

```sh
$ make dev
```

### Generating new certificates

```sh
$ make gen-certs
```

## Log capture from a game

```log
❯ make run
docker-compose up
[+] Running 2/0
 ⠿ Container handin2-alice-1  Created                                                                                                                                                                                    0.0s
 ⠿ Container handin2-bob-1    Created                                                                                                                                                                                    0.0s
Attaching to handin2-alice-1, handin2-bob-1
handin2-alice-1  | 19:31:19.439 [info] Rolled for client 4
handin2-alice-1  | 19:31:19.441 [info] Bitstring for client roll: "EF80D60D0789454A860C5D0BD6958BB5DD45FC797E7E8F90B4A9CAD16D277FB80396747CFB6C304EA5F3B7F101714B428E981965AD104392886D4C145566315197D36A09C1607771AE86CAAB2FDAAF5647CDF3DB335331ACA287B80FCC5FAB262B33206429738B267BB88FAF9BA8595840AE34BB72E126360D3C6057DF0143356D3C54CFF699033DE88F12827F617FE40AED95490883AB3EDDBA7DC91321ACE5474C70D3CFD4E93B1570E203DE2080AFE4EEAFB7B0CB43AB1F67CBAF2
ABB6FB7A583EC1696319F7FBE60ECABDFFA624AE54B3398867A1BE8FD490C7DD14E4308C248D7D856B9DD2D9C81511CEFE6F0081AB9C838EBDC1FFE6D037B59D85711D0"
handin2-alice-1  | 19:31:19.441 [info] Commitment for client roll: "8F7ECD8A23D846C5E3E01AD851BE25BE7ABD9292A3CCA453830F3B8E04062E55"
handin2-alice-1  | 19:31:19.441 [info] Rolled for server 5
handin2-alice-1  | 19:31:19.441 [info] Bitstring for server roll: "041D5A345AB33BE2CFA323B52F05E4716968EA2EB890994B4933426A58FD69433C0A556CEA06716D806E11A7BB9E01EC98386F5718D576329B0C31EFD9F1A1DE3EAB41DD5E7163EBEB4F885556CF3A370A10C7641B3638BAFA4403E88FB2C4303DB56A625E1A55C08AFE9BFC881C64EC9613643D6ACA5C84DC09EFDFCE6ADF3A32DB1552CCAD10255C6591739747AEEB25B11CACF5A21B646301962E3E742EB5DD753460EEEC425E25A1BC94CC96FA2B292C613C7B623F9B4113BBEC9A7B485B9926BF3F92901094BA15829FC449598D84DF7905272F04E92BED2AB60FE8C306B3A49F0983BCAE01A25FAB5D237674E5508C3E5291707C85143F95809A40D072"
handin2-alice-1  | 19:31:19.441 [info] Commitment for server roll: "8FB9680CAFB1AD73A621C31A2A76D3B397CCACA330ABB9A2885DE96B0248247A"
handin2-alice-1  | 19:31:19.441 [info] Making commitments to server
handin2-bob-1    | 19:31:19.660 [info] Rolled for client 4
handin2-bob-1    | 19:31:19.661 [info] Bitstring for client roll: "3E259F2A4402F5D56847B446EA3A2C801CC67B4B3FF2CEB374E7FCF2AA0FCA4FF1B0E471210FF8ECB509749F48732CF138BFAE9B17382CF68BC2652AD695E22786DD5B578E0E82E78ED6292F6D679E99D7FEBF2120CE1ABB4796D2B9EF2FA4042415039D486B871F2743C5617AA2B2727B4B6101061D82BC32537265CD8375E6BCE24C5D089556630EFCF68310FFB223371C357B894E04499736C2FB44BE11278990ED895264DCCAFBF4D791FF5B3805AD5F90A6E3A6C4A3DC3CCCEE855FA2DF493D40A5C8FADCB4AE417000669977EC43EE4167AD1559D6D3A5B508244FC84E76C035EDDDEBE028A9F605CCF71DF9118B22F4CBFD3D6E8768FCEDA51275334C"
handin2-bob-1    | 19:31:19.661 [info] Commitment for client roll: "222034CF643AC71D5E4F0445F8930638E81B0153AD116FBDDFD6E236177FC399"
handin2-bob-1    | 19:31:19.661 [info] Rolled for server 5
handin2-bob-1    | 19:31:19.661 [info] Bitstring for server roll: "629B5BD29A4DD5C7ED8D45F438B9E9A0194BE84800713EB37B9E56660170BB0BA79D4F6EBB68B1AA8990D6A9BD6FAB77F08157C318DEDB9CBD3A4CC27BDE19C69285B591F3ED3153D4E247218068423BB9B7C5972B02BB0D95D05131B812D6D3A57484C66EB80B42E9C68CE9AE552F2B964D38004C1BB2FAA9D6235CDEC10886A51A1B3567F39D886FF9FD5AB7362C4E46FB0D0203A61C352D15695BC6DA9BACBD440376364588F6E4A18281BB15E7621870B401F72B83D1F4657ECF269EF8520465D07E21275B09A7193F4A74413A4442122B43C66FF746DC1F0767C403B196B5284715304F9B83CDDAF25AE54EA5E47BE98DAAF70FC0ADD7E3C456D981BCDF"
handin2-bob-1    | 19:31:19.661 [info] Commitment for server roll: "8CDF8497F3A313C9655D970797E87CF631AEB92D2A0C50D7482E8C7AED4F9741"
handin2-bob-1    | 19:31:19.661 [info] Reveals commitment to client
handin2-alice-1  | 19:31:19.678 [info] Revealing commitments to server
handin2-bob-1    | 19:31:19.682 [info] Verified remote composite roll: 4, bitstring: "EF80D60D0789454A860C5D0BD6958BB5DD45FC797E7E8F90B4A9CAD16D277FB80396747CFB6C304EA5F3B7F101714B428E981965AD104392886D4C145566315197D36A09C1607771AE86CAAB2FDAAF5647CDF3DB335331ACA287B80FCC5FAB262B33206429738B267BB88FAF9BA8595840AE34BB72E126360D3C6057DF0143356D3C54CFF699033DE88F12827F617FE40AED95490883AB3EDDBA7DC91321ACE5474C70D3CFD4E93B1570E203DE2080AFE4EEAFB7B0CB43AB1F67CBAF2ABB6FB7A583EC1696319F7FBE60ECABDFFA624AE54B3398867A1BE8FD490C7DD14E4308C248D7D856B9DD2D9C81511CEFE6F0081AB9C838EBDC1FFE6D037B59D85711D0", commitment: "8F7ECD8A23D846C5E3E01AD851BE25BE7ABD9292A3CCA453830F3B8E04062E55"
handin2-bob-1    | 19:31:19.682 [info] Verified remote composite roll: 5, bitstring: "041D5A345AB33BE2CFA323B52F05E4716968EA2EB890994B4933426A58FD69433C0A556CEA06716D806E11A7BB9E01EC98386F5718D576329B0C31EFD9F1A1DE3EAB41DD5E7163EBEB4F885556CF3A370A10C7641B3638BAFA4403E88FB2C4303DB56A625E1A55C08AFE9BFC881C64EC9613643D6ACA5C84DC09EFDFCE6ADF3A32DB1552CCAD10255C6591739747AEEB25B11CACF5A21B646301962E3E742EB5DD753460EEEC425E25A1BC94CC96FA2B292C613C7B623F9B4113BBEC9A7B485B9926BF3F92901094BA15829FC449598D84DF7905272F04E92BED2AB60FE8C306B3A49F0983BCAE01A25FAB5D237674E5508C3E5291707C85143F95809A40D072", commitment: "8FB9680CAFB1AD73A621C31A2A76D3B397CCACA330ABB9A2885DE96B0248247A"
handin2-bob-1    | 19:31:19.682 [info] The clients commitments were valid!
handin2-bob-1    | 19:31:19.682 [info] The game is over!
handin2-bob-1    | 19:31:19.682 [info] The client rolled 3
handin2-bob-1    | 19:31:19.682 [info] The server rolled 5
handin2-bob-1    | 19:31:19.682 [info] Winning party: me
handin2-alice-1  | 19:31:19.685 [info] Verified remote composite roll: 4, bitstring: "3E259F2A4402F5D56847B446EA3A2C801CC67B4B3FF2CEB374E7FCF2AA0FCA4FF1B0E471210FF8ECB509749F48732CF138BFAE9B17382CF68BC2652AD695E22786DD5B578E0E82E78ED6292F6D679E99D7FEBF2120CE1ABB4796D2B9EF2FA4042415039D486B871F2743C5617AA2B2727B4B6101061D82BC32537265CD8375E6BCE24C5D089556630EFCF68310FFB223371C357B894E04499736C2FB44BE11278990ED895264DCCAFBF4D791FF5B3805AD5F90A6E3A6C4A3DC3CCCEE855FA2DF493D40A5C8FADCB4AE417000669977EC43EE4167AD1559D6D3A5B508244FC84E76C035EDDDEBE028A9F605CCF71DF9118B22F4CBFD3D6E8768FCEDA51275334C", commitment: "222034CF643AC71D5E4F0445F8930638E81B0153AD116FBDDFD6E236177FC399"
handin2-alice-1  | 19:31:19.685 [info] Verified remote composite roll: 5, bitstring: "629B5BD29A4DD5C7ED8D45F438B9E9A0194BE84800713EB37B9E56660170BB0BA79D4F6EBB68B1AA8990D6A9BD6FAB77F08157C318DEDB9CBD3A4CC27BDE19C69285B591F3ED3153D4E247218068423BB9B7C5972B02BB0D95D05131B812D6D3A57484C66EB80B42E9C68CE9AE552F2B964D38004C1BB2FAA9D6235CDEC10886A51A1B3567F39D886FF9FD5AB7362C4E46FB0D0203A61C352D15695BC6DA9BACBD440376364588F6E4A18281BB15E7621870B401F72B83D1F4657ECF269EF8520465D07E21275B09A7193F4A74413A4442122B43C66FF746DC1F0767C403B196B5284715304F9B83CDDAF25AE54EA5E47BE98DAAF70FC0ADD7E3C456D981BCDF", commitment: "8CDF8497F3A313C9655D970797E87CF631AEB92D2A0C50D7482E8C7AED4F9741"
handin2-alice-1  | 19:31:19.685 [info] The servers commitments were valid!
handin2-alice-1  | 19:31:19.685 [info] The game is over!
handin2-alice-1  | 19:31:19.685 [info] The client rolled 3
handin2-alice-1  | 19:31:19.685 [info] The server rolled 5
handin2-alice-1  | 19:31:19.685 [info] Winning party: opponent
^CGracefully stopping... (press Ctrl+C again to force)```
